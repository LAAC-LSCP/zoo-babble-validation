---
title: "Chunk_level_jslhr"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.width=12, fig.height=8) 
library(tidyverse)
library(dplyr)
library(ggplot2)
library(caret)
library(scales)
dodiv=function(x) x/sum(x, na.rm=T)
```

```{r cars}
zoon_chunks=read.csv("/Users/chiarasemenzin/Desktop/chunk_majority_agreement.csv",sep=",")
demo_data=read.csv("/Users/chiarasemenzin/Documents/GitHub/zoo-babble-validation/Data/demo-data.tsv",sep="\t")
demo_data$Child_ID<-demo_data$ChildID
data_all<-left_join(zoon_chunks,demo_data,by="Child_ID")
ratios_seg<-read.csv("/Users/chiarasemenzin/ratios_lb_z.csv")
```


```{r prepare data by child}
#get the ns by child, then calculate the linguistic ratio & canonical ratio, separately for zooniverse & lab
ztab=table(data_all$Child_ID,data_all$Answer)
z_lr=rowSums(ztab[,c("Canonical","Non-Canonical")])/rowSums(ztab[,-which(colnames(ztab) %in% c("Junk"))])
z_cr=ztab[,c("Canonical")]/rowSums(ztab[,c("Canonical","Non-Canonical")])
ratios=as.data.frame(cbind(rownames(ztab),z_lr,z_cr))
colnames(ratios)[1]<-"Child_ID"
merge(ratios,demo_data,by="Child_ID")->ratios
ratios$z_lr<-as.numeric(ratios$z_lr)
ratios$z_cr<-as.numeric(ratios$z_cr)
```

```{r corage}
prettynames=c("Linguistic Ratio (Zooniverse)","Canonical Ratio (Zooniverse)",
             "Linguistic Ratio (Lab)","Canonical Ratio (Lab)" )
names(prettynames)<-c("z_lr","z_cr")
#!!! this is working the opposite than it should! but note that to get angsynd kids to come out in red, I have to do it like this -- it doesn't make sense...
# Now it works alright
mycols=c("black","red")
names(mycols)<-c("Low-RiskControl","AngelmanSyndrome")
for(thisvar in c("z_lr","z_cr")) {
  myr=round(cor.test(ratios[,thisvar],ratios$Age)$estimate,3)
  print(cor.test(ratios[,thisvar],ratios$Age))
  plot(ratios[,thisvar]~ratios$Age, pch=20,xlab="Age (months)",ylab=prettynames[thisvar],main=paste0("r=",myr),
       col=mycols[ratios$Diagnosis])
  abline(lm(ratios[,thisvar]~ratios$Age))
  }
```
``````{r corage}
prettynames=c("Linguistic Ratio (Zooniverse)","Canonical Ratio (Zooniverse)")
names(prettynames)<-c("z_lr","z_cr")
AS_ratios<-subset(ratios, Diagnosis=="AngelmanSyndrome")
TD_ratios<-subset(ratios, Diagnosis=="Low-RiskControl")

mycols=c("black","red")
names(mycols)<-c("Low-RiskControl","AngelmanSyndrome")
for(thisvar in c("z_lr","z_cr")) {
  myr=round(cor.test(AS_ratios[,thisvar],AS_ratios$Age)$estimate,3)
  plot(AS_ratios[,thisvar]~AS_ratios$Age, pch=20,xlab="Age (months)",ylab=prettynames[thisvar],main=paste0("r=",myr))
  abline(lm(AS_ratios[,thisvar]~AS_ratios$Age))
  print(thisvar)
  print(cor.test(AS_ratios[,thisvar],AS_ratios$Age))
}

for(thisvar in c("z_lr","z_cr")) {
  myr=round(cor.test(TD_ratios[,thisvar],TD_ratios$Age)$estimate,3)
  plot(TD_ratios[,thisvar]~TD_ratios$Age, pch=20,xlab="Age (months)",ylab=prettynames[thisvar],main=paste0("r=",myr))
  abline(lm(TD_ratios[,thisvar]~TD_ratios$Age))
  print(thisvar)
  print(cor.test(TD_ratios[,thisvar],TD_ratios$Age))
  }
```


```{r corlab zoo}
pdf("/Users/chiarasemenzin/Documents/GitHub/zoo-babble-validation/Results/ling_rat_z_vs_l_chunk.pdf",height=5,width=5)

ratios<-left_join(ratios,ratios_seg[c("l_lr","l_cr","ChildID")],by="ChildID")

lims=range(c(ratios[,"z_lr"],ratios[,"l_lr"]))
  myr=round(cor.test(ratios[,"z_lr"],ratios[,"l_lr"])$estimate,3)
  plot(ratios[,"z_lr"]~ratios[,"l_lr"], pch=20,xlab=prettynames["l_lr"],ylab=prettynames["z_lr"],main=paste0("r=",myr),
       xlim=lims,ylim=lims,
       col=mycols[ratios$Diagnosis])
  abline(lm(ratios[,"z_lr"]~ratios[,"l_lr"]))
  lines(c(0,1),c(0,1),lty=2,col="darkgray")
dev.off()
print(cor.test(ratios[,"z_lr"],ratios[,"l_lr"]))

  #CR
pdf("/Users/chiarasemenzin/Documents/GitHub/zoo-babble-validation/Results/can_rat_z_vs_l_chunk.pdf",height=5,width=5)
lims=range(c(ratios[,"z_cr"],ratios[,"l_cr"]))
    myr=round(cor.test(ratios[,"z_cr"],ratios[,"l_cr"])$estimate,3)
  plot(ratios[,"z_cr"]~ratios[,"l_cr"], pch=20,xlab=prettynames["l_cr"],ylab=prettynames["z_cr"],main=paste0("r=",myr),
       xlim=lims,ylim=lims,
       col=mycols[ratios$Diagnosis])
  abline(lm(ratios[,"z_cr"]~ratios[,"l_cr"]),col="darkgray")
    lines(c(0,1),c(0,1),lty=2,col="darkgray")
dev.off()
print(cor.test(ratios[,"z_cr"],ratios[,"l_cr"]))
```

``` {r subsetdata}
prettynames=c("AS Linguistic Ratio (Zooniverse)","AS Canonical Ratio (Zooniverse)",
             "AS Linguistic Ratio (Lab)","AS Canonical Ratio (Lab)" )
names(prettynames)<-c("z_lr","z_cr","l_lr","l_cr")

AS_ratios<-subset(ratios, Diagnosis=="AngelmanSyndrome")
TD_ratios<-subset(ratios, Diagnosis=="Low-RiskControl")
``` 

``` {r cor pred}
pdf("/Users/chiarasemenzin/Documents/GitHub/zoo-babble-validation/Results/td_ling_rat_z_vs_l_chunk.pdf",height=5,width=5)
lims=range(c(TD_ratios[,"z_lr"],TD_ratios[,"l_lr"]))
  myr=round(cor.test(TD_ratios[,"z_lr"],TD_ratios[,"l_lr"])$estimate,3)
  plot(TD_ratios[,"z_lr"]~TD_ratios[,"l_lr"], pch=20,xlab=prettynames["l_lr"],ylab=prettynames["z_lr"],main=paste0("r=",myr),
       xlim=lims,ylim=lims,
       col=mycols[TD_ratios$Diagnosis])
  abline(lm(TD_ratios[,"z_lr"]~TD_ratios[,"l_lr"]))
  lines(c(0,1),c(0,1),lty=2,col="darkgray")
dev.off()
print(cor.test(TD_ratios[,"z_lr"],TD_ratios[,"l_lr"]))

  #CR
pdf("/Users/chiarasemenzin/Documents/GitHub/zoo-babble-validation/Results/td_can_rat_z_vs_l_final.pdf",height=5,width=5)
lims=range(c(TD_ratios[,"z_cr"],TD_ratios[,"l_cr"]))
    myr=round(cor.test(TD_ratios[,"z_cr"],TD_ratios[,"l_cr"])$estimate,3)
  plot(TD_ratios[,"z_cr"]~TD_ratios[,"l_cr"], pch=20,xlab=prettynames["l_cr"],ylab=prettynames["z_cr"],main=paste0("r=",myr),
       xlim=lims,ylim=lims,
       col=mycols[TD_ratios$Diagnosis])
  abline(lm(TD_ratios[,"z_cr"]~TD_ratios[,"l_cr"]),col="darkgray")
    lines(c(0,1),c(0,1),lty=2,col="darkgray")
dev.off()
print(cor.test(TD_ratios[,"z_cr"],TD_ratios[,"l_cr"]))
```
```{r corlab-zoo}
#Ling ratio
pdf("/Users/chiarasemenzin/Documents/GitHub/zoo-babble-validation/Results/AS_ling_rat_z_vs_l_chunks.pdf",height=5,width=5)
lims=range(c(AS_ratios[,"z_lr"],AS_ratios[,"l_lr"]))
  myr=round(cor.test(AS_ratios[,"z_lr"],AS_ratios[,"l_lr"])$estimate,3)
  plot(AS_ratios[,"z_lr"]~AS_ratios[,"l_lr"], pch=20,xlab=prettynames["l_lr"],ylab=prettynames["z_lr"],main=paste0("r=",myr),
       xlim=lims,ylim=lims,
       col=mycols[AS_ratios$Diagnosis])
  abline(lm(AS_ratios[,"z_lr"]~AS_ratios[,"l_lr"]))
  lines(c(0,1),c(0,1),lty=2,col="darkgray")
dev.off()
print(cor.test(AS_ratios[,"z_lr"],AS_ratios[,"l_lr"]))
  #CR
pdf("/Users/chiarasemenzin/Documents/GitHub/zoo-babble-validation/Results/AS_can_rat_z_vs_l_chunks.pdf",height=5,width=5)
lims=range(c(AS_ratios[,"z_cr"],AS_ratios[,"l_cr"]))
    myr=round(cor.test(AS_ratios[,"z_cr"],AS_ratios[,"l_cr"])$estimate,3)
  plot(AS_ratios[,"z_cr"]~AS_ratios[,"l_cr"], pch=20,xlab=prettynames["l_cr"],ylab=prettynames["z_cr"],main=paste0("r=",myr),
       xlim=lims,ylim=lims,
       col=mycols[AS_ratios$Diagnosis])
  abline(lm(AS_ratios[,"z_cr"]~AS_ratios[,"l_cr"]),col="darkgray")
    lines(c(0,1),c(0,1),lty=2,col="darkgray")
dev.off()
print(cor.test(AS_ratios[,"z_cr"],AS_ratios[,"l_cr"]))
```
Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
